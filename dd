import requests
import json
import os

# Suas credenciais
DD_API_KEY = os.getenv("DATADOG_API_KEY")
DD_APP_KEY = os.getenv("DATADOG_APP_KEY")

# Endpoint da API (pode trocar para us3/us5/eu)
DATADOG_API_URL = "https://api.datadoghq.com"

# Query simples
payload = {
    "filter": {
        "query": "service:meu-servico",
        "from": "now-1h",
        "to": "now"
    },
    "page": {"limit": 100}
}

# Requisição HTTP
response = requests.post(
    f"{DATADOG_API_URL}/api/v2/logs/events/search",
    headers={
        "DD-API-KEY": DD_API_KEY,
        "DD-APPLICATION-KEY": DD_APP_KEY,
        "Content-Type": "application/json"
    },
    data=json.dumps(payload)
)

# Resultado
if response.status_code == 200:
    data = response.json()
    print("✔ Dados recebidos com sucesso!")
    print(json.dumps(data, indent=2))
else:
    print("❌ Erro ao chamar API:", response.status_code)
    print(response.text)
